AC_INIT(configure.in)

AC_SEARCH_LIBS([ioperm], [ioperm])

AC_CANONICAL_HOST

build_bitbang=no
is_cygwin=no

AC_ARG_ENABLE(parport,
  AS_HELP_STRING([--enable-parport], [Enable building the pc parallel port driver]), 
  [build_parport=$enableval], [build_parport=no])

AC_ARG_ENABLE(parport_ppdev,
  AS_HELP_STRING([--enable-parport_ppdev], [Enable use of ppdev (/dev/parportN) for parport]), 
  [parport_use_ppdev=$enableval], [parport_use_ppdev=no])

AC_ARG_ENABLE(ftdi2232,
  AS_HELP_STRING([--enable-ftdi2232], [Enable building the libftdi ft2232c driver]), 
  [build_ftdi2232=$enableval], [build_ftdi2232=no])

AC_ARG_ENABLE(ftd2xx,
  AS_HELP_STRING([--enable-ftd2xx], [Enable building the ftd2xx ft2232c driver]), 
  [build_ftd2xx=$enableval], [build_ftd2xx=no])
 
AC_ARG_ENABLE(amtjtagaccel,
  AS_HELP_STRING([--enable-amtjtagaccel], [Enable building the Amontec JTAG-Accelerator driver]), 
  [build_amtjtagaccel=$enableval], [build_amtjtagaccel=no])

AC_ARG_ENABLE(ep93xx,
  AS_HELP_STRING([--enable-ep93xx], [Enable building support for EP93xx based SBCs]), 
  [build_ep93xx=$enableval], [build_ep93xx=no])

AC_ARG_WITH(ftd2xx,
        [AS_HELP_STRING(--with-ftd2xx,
           [Where libftd2xx can be found <default=search>])],
        [],
        with_ftd2xx=search)

if test $build_parport = yes; then
  build_bitbang=yes
  AC_DEFINE(BUILD_PARPORT, 1, [1 if you want parport.])
else
  AC_DEFINE(BUILD_PARPORT, 0, [0 if you don't want parport.])
fi

if test $build_ep93xx = yes; then
  build_bitbang=yes
  AC_DEFINE(BUILD_EP93XX, 1, [1 if you want ep93xx.])
else
  AC_DEFINE(BUILD_EP93XX, 0, [0 if you don't want ep93xx.])
fi

if test $parport_use_ppdev = yes; then
  AC_DEFINE(PARPORT_USE_PPDEV, 1, [1 if you want parport to use ppdev.])
else
  AC_DEFINE(PARPORT_USE_PPDEV, 0, [0 if you don't want parport to use ppdev.])
fi

if test $build_bitbang = yes; then
  AC_DEFINE(BUILD_BITBANG, 1, [1 if you want a bitbang interface.])
else
  AC_DEFINE(BUILD_BITBANG, 0, [0 if you don't want a bitbang interface.])
fi

if test $build_ftdi2232 = yes; then
  AC_DEFINE(BUILD_FTDI2232, 1, [1 if you want libftdi ft2232.])
else
  AC_DEFINE(BUILD_FTDI2232, 0, [0 if you don't want libftdi ft2232.])
fi

if test $build_ftd2xx = yes; then
  AC_DEFINE(BUILD_FTD2XX, 1, [1 if you want ftd2xx ft2232.])
else
  AC_DEFINE(BUILD_FTD2XX, 0, [0 if you don't want ftd2xx ft2232.])
fi

if test $build_amtjtagaccel = yes; then
  AC_DEFINE(BUILD_AMTJTAGACCEL, 1, [1 if you want the Amontec JTAG-Accelerator driver.])
else
  AC_DEFINE(BUILD_AMTJTAGACCEL, 0, [0 if you don't want the Amontec JTAG-Accelerator driver.])
fi

case $host in 
  *-*-cygwin*) 
    is_cygwin=yes
    AC_DEFINE(IS_CYGWIN, 1, [1 if building for Cygwin.])
    ;; 
  *) 
    AC_DEFINE(IS_CYGWIN, 0, [0 if not building for Cygwin.])
    ;;
esac

AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(openocd, 0.1)

AM_CONDITIONAL(PARPORT, test $build_parport = yes)
AM_CONDITIONAL(EP93XX, test $build_ep93xx = yes)
AM_CONDITIONAL(BITBANG, test $build_bitbang = yes)
AM_CONDITIONAL(FTDI2232, test $build_ftdi2232 = yes)
AM_CONDITIONAL(FTD2XX, test $build_ftd2xx = yes)
AM_CONDITIONAL(AMTJTAGACCEL, test $build_amtjtagaccel = yes)
AM_CONDITIONAL(IS_CYGWIN, test $is_cygwin = yes)
AM_CONDITIONAL(FTD2XXDIR, test $with_ftd2xx != search)

AC_LANG_C
AC_PROG_CC
AC_PROG_RANLIB

AC_SUBST(WITH_FTD2XX, $with_ftd2xx)

AC_OUTPUT(Makefile src/Makefile src/helper/Makefile src/jtag/Makefile src/xsvf/Makefile src/target/Makefile src/server/Makefile src/flash/Makefile)
